<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inext.manage_system.dao.InterviewDao">
    
    <!-- インタビュー検索 by gender、class、name、age --> 
    <select id="selectInterview" resultType="com.inext.manage_system.model.Interview">
        SELECT *
        FROM interview_table.interview 
        <where> 
            <if test="req.idClass != '' ">
                id_class = #{req.idClass}
            </if>
            AND gender LIKE CONCAT('%', #{req.gender}, '%')
            AND age BETWEEN #{req.age1} AND #{req.age2}
            AND (firstname_eng LIKE CONCAT('%', #{req.name}, '%')
                 OR lastname_eng LIKE CONCAT('%', #{req.name}, '%')
                 OR name_cn LIKE CONCAT('%', #{req.name}, '%'))
            AND del_flg = 0
        </where>
    </select>

    <!-- インタビュー検索 by id -->
    <select id="selectInterviewById" resultType="com.inext.manage_system.model.Interview">
        SELECT *
        FROM interview_table.interview 
        WHERE id = #{id}; 
    </select>

    <!-- インタビュー検索 by id -->
    <select id="selectUserInterviewById" resultType="com.inext.manage_system.model.Interview">
        SELECT *
        FROM interview_table.user_interview_data 
        WHERE id = #{id}; 
    </select>

    <!-- インタビュー編修保存、使用者新規保存 -->
    <update id="updateInterview"> 
        UPDATE interview_table.interview 
        SET title = #{saveReq.title}, 
            profile = #{saveReq.profile}, 
            photo = #{saveReq.photo}, 
            video = #{saveReq.video},
            life_video = #{saveReq.lifeVideo} 
        WHERE id = #{saveReq.id}; 
    </update>

    <!-- 使用者新規保存 -->
    <update id="updateUserInterview"> 
        UPDATE interview_table.user_interview_data
        SET title = #{saveReq.title}, 
            profile = #{saveReq.profile}, 
            photo = #{saveReq.photo}, 
            video = #{saveReq.video},
            life_video = #{saveReq.lifeVideo} 
        WHERE id = #{saveReq.id}; 
    </update>

    <!-- インタビュー削除 -->
    <update id = "delInterview"> 
        UPDATE interview_table.interview 
        SET del_flg = 1 
        WHERE id = #{id}; 
    </update>

    <!-- IDの存在を確認する -->
    <select id="checkId" resultType="int">
        SELECT EXISTS(SELECT * FROM interview_table.interview WHERE id = #{id})
    </select>

</mapper>